# Collab — Developer Coordination System

This folder is the shared coordination layer for the two-developer team working on Talent Hub.
**It lives in the repo and gets committed.** Both devs keep it up to date.

---

## Who Are We

| Handle | Name | Responsibility |
|---|---|---|
| `aryan` | Aryan Pawar | Dev A |
| `bakul` | Bakul Brinda Chakravarty | Dev B |

---

## Files in This Folder

| File | Purpose |
|---|---|
| `features.json` | Feature registry — what's being built, by whom, at what risk |
| `file-ownership.json` | Map of every source file → current owner + lock state |
| `clash-rules.md` | High-risk shared files that need coordination before editing |
| `README.md` | This file — how to use the system |

---

## Workflow: Starting a New Feature

### Step 1 — Register the Feature

Add an entry to `features.json`:

```json
{
  "id": "feat-004",
  "title": "AI Chat with streaming",
  "description": "Claude-powered chat widget with SSE streaming in the sidebar",
  "status": "in-progress",
  "assigned_to": "aryan",
  "files_affected": [
    "backend/src/routes/aiChat.routes.ts",
    "backend/src/services/aiChat.service.ts",
    "frontend/src/pages/AIChatPage.tsx",
    "frontend/src/App.tsx"
  ],
  "risk_level": "medium",
  "clash_with": ["frontend/src/App.tsx", "backend/src/app.ts"]
}
```

**Status values:** `pending` | `in-progress` | `done`
**Risk levels:**
- `low` — new isolated files only, no shared files touched
- `medium` — touches 1–2 shared files OR modifies existing logic
- `high` — touches Tier 1/2 files from `clash-rules.md`, schema changes, or auth changes

### Step 2 — Lock Files You're Working On

For any file you're actively editing (especially high-risk ones), set `"locked": true` in `file-ownership.json`:

```json
"frontend/src/App.tsx": {
  "owner": "aryan",
  "feature": "feat-004",
  "locked": true
}
```

This signals to your co-dev: **do not edit this file right now.**

### Step 3 — Do the Work

Create a focused git branch: `feat/feat-004-ai-chat` or `fix/employee-filter-bug`.

Commit often. Push daily even if unfinished (use draft PRs).

### Step 4 — Finish and Unlock

When your feature is merged:

1. Set `"status": "done"` in `features.json`
2. Reset ownership in `file-ownership.json`:
   ```json
   "frontend/src/App.tsx": { "owner": "unassigned", "feature": null, "locked": false }
   ```
3. Update `CLAUDE.md` → "Currently Working On" section if your name is there

---

## Workflow: Handling Clashes

If you need to edit a file that is:
- Listed as Tier 1 or Tier 2 in `clash-rules.md`, OR
- Currently `"locked": true` by the other dev

**Do this:**

1. Talk to the other dev first (message, call, whatever)
2. Agree on who makes the change and when
3. If both changes are needed: the person whose feature depends more on it goes first
4. The other dev pulls and rebases after the first person merges

**Never silently edit a locked file.** Merge conflicts in critical files waste more time than the conversation takes.

---

## Feature ID Convention

Use sequential IDs: `feat-001`, `feat-002`, etc.

For bug fixes: `fix-001`, `fix-002`, etc.

For infrastructure/config changes: `infra-001`, `infra-002`, etc.

---

## Checking What's In Progress

```bash
# Quick glance at active features
cat collab/features.json | python3 -m json.tool

# Check if a specific file is locked
cat collab/file-ownership.json | python3 -c "import sys,json; d=json.load(sys.stdin); print(d['files'].get('frontend/src/App.tsx', 'not found'))"
```

Or just open the files in any editor — they're plain JSON and Markdown.

---

## Updating CLAUDE.md

When you:
- Add a new page → update the pages list in CLAUDE.md
- Add a new API route → update the route groups section
- Add a new Prisma model → update the models table
- Add a new npm package → update the tech stack table
- Start a feature → update the "Currently Working On" section

CLAUDE.md is the live architecture reference. Keep it accurate.

---

## Git Conventions

```
feat/feat-XXX-short-description   # new features
fix/fix-XXX-short-description     # bug fixes
infra/infra-XXX-short-description # config, deps, deployment
chore/update-collab               # collab file updates only
```

Commit messages:
```
feat(ai-chat): add streaming SSE endpoint [feat-004]
fix(employee-filter): handle empty band array correctly [fix-001]
collab: assign feat-004 to aryan, lock App.tsx
```

---

## Emergency: Resolving a Conflict in a Critical File

If you get a merge conflict in `shared/types/index.ts`, `prisma/schema.prisma`, or `lib/prisma.ts`:

1. **Do not auto-resolve with "accept all mine" or "accept all theirs"**
2. Open the file and manually review every conflict block
3. For `schema.prisma`: run `npx prisma validate` after resolving to verify the schema is valid
4. For `shared/types/index.ts`: run `npm run build` in both backend and frontend to confirm no type errors
5. Commit the resolved file with: `git commit -m "chore: resolve conflict in [filename] — manual review"`

---

## Demo Credentials (for testing)

- Email: `admin@company.com`
- Password: `Admin@123`
- Tunnel URL: see `/tmp/cloudflared.log` on the host machine
